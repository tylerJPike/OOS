---
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(OOS)
```

# Model Customization and Control

Users may edit any model training routine through accessing a list of function arguments. For machine learning techniques, this entails editing [caret](https://github.com/topepo/caret) arguments including: tuning grid, control grid, method, and accuracy metric. For univariate time series forecasting, this entails passing arguments to [forecast](https://github.com/robjhyndman/forecast) package model functions. For imputing missing variables, this entails passing arguments to [imputeTS](https://github.com/SteffenMoritz/imputeTS) package functions.

## Univariate models from forecast

Models sourced from the forecast package require all differ slightly, thus the forecsat documentation should be a users first stop when deciding what arguments to pass through to the function. By default, OOS uses the default forecast implementation of a given model. However, here we show a brief example of how to dictate that the Arima function takes on the form of an AR(12). 

A brief example using an `Arima` model to forecast univariate time series:   

```{r}

# 1. create the central list of univariate model training arguments, univariate.forecast.training  
forecast_univariate.control_panel = instantiate.forecast_univariate.control_panel() 

# 2. select an item to edit, for example the Arima order to create an ARMA(1,1)   
# view default model arguments (there are none)  
forecast_univariate.control_panel$arguments[['Arima']] 
# add our own function arguments  
forecast_univariate.control_panel$arguments[['Arima']]$order = c(1,0,1) 

```

##  Data imputation with imputeTS
Methods used to impute missing data are sourced from the imputeTS package, and a user interfaces with these routines in the same manner as they would with functions from the forecast package. By default, OOS uses the imputeTS default implementation of a given method. 

## Multivariate models from caret

Multivariate models are trained via the caret package, which means a user may access and edit: 
 
1. caret.engine: a string declaring the name of the caret recognized model to use  
2. tuning.grids: a matrix of parameters for a grid search training routine  
3. control: a list of variables controlling the parameter estimation (training) routine 
4. accuracy: a string denoting what accuracy metric to use in model (estimation) training 

Note that all models access the same control and accuracy. 

A brief example using the `Random Forest` to combine forecasts:   

```{r}

# 1. create the central list of ML training arguments 
forecast_combinations.control_panel = instantiate.forecast_combinations.control_panel()  

# 2. select an item to edit, for example the random forest tuning grid   
# view RF model name 
forecast_combinations.control_panel$caret.engine[['RF']] 

# view default tuning grid  
forecast_combinations.control_panel$tuning.grids[['RF']]  

# edit tuning grid   
forecast_combinations.control_panel$tuning.grids[['RF']] = expand.grid(mtry = c(1:6)) 
# and view result
forecast_combinations.control_panel$tuning.grids[['RF']]

# view default training control
forecast_combinations.control_panel$control

```

